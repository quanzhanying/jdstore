<h1>&nbsp 我的訂單</h1>


<div class="container-fluid ">
  <table class="table table-bordered">
    <thead >
      <tr>
        <th>My orders</th>
        <th>商品數量</th>
        <th>訂貨人</th>
        <th>價格</th>
        <th>付款狀態</th>
        <th>發貨狀態</th>
        <th>訂單狀態</th>
        
      </tr>
    </thead>
    <tbody class="split-tbody">
      <tr>
        <td colspan="6">&nbsp</td>
      </tr>
  <% @orders.each do |order| %>
  <% order.product_lists.each do |product_list| %>
    <tr>
      <td>
        <%= order.created_at.strftime("%Y-%m-%d %H:%M:%S") %>
      </td>
      <td colspan="5">
        Order No : <%= link_to(order.token,account_orders_path(order.token)) %>
      </td>
      <tr>
      <td><%= product_list.product_name %></td>
      <td>x<%= product_list.quantity %></td>
      <td >
        <%= order.shipping_name %>
      </td>
      <td >
        TotalPrice ¥ <%= order.total %>
        <br />
        <% if order.payment_method =='alipay' %>
          Alipay
        <% else %>
          <% order.payment_method =='Wechat' %>
          Wechat
        <% end %>
      </td>
      <td >
        <% if order.is_paid?%>
          已支付
         <% elsif order.aasm_state == 'order_cancelled' %>
        <% else %>

         <%= link_to("去支付", order_path(order.token),class:"btn btn-danger") %>
        <% end %>
      </td>

      <td>
        <% if order.shipping? %>
        已出貨

        <% else %>
        未出貨
        <% end %>      
      </td>
              
      <td>
        <%#= render_order_status(order) %>
        <% if order.order_cancelled? %>
        <%= link_to("正在取消订单", apply_to_cancel_order_path(order), method: :post, class: "btn disabled") %><br />
        <% else %>


        <% if order.shipping? %>

        <%= link_to("申請退貨", return_good_order_path(order), method: :post, class: "btn disabled") %><br />
        
        <% elsif !order.is_paid? %>

        <% else %>
        <%= link_to("申請取消订单", apply_to_cancel_order_path(order,aasm_state: "order_cancelled"), method: :post,class:"btn btn-danger",data: { disable_with: "申請中..."}) %> 
        <% end %>

        <% end %>      
       
      </td>


       

     
    </tr>
  </tbody>
  <% end %>
  <% end %>
  </table>
</div>